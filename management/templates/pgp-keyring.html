<style>
    #pgp_keyring_config .status-error td {
		color: rgb(140, 0, 0);
	}

	#pgp_keyring_config .status-warning td {
		color: rgb(170, 120, 0);
	}

	#pgp_keyring_config .status-ok td {
		color: rgb(0, 140, 0);
	}

    #pgp_keyring_config .status-none td {
        color: rgb(180, 180, 180);
    }
</style>

<h2>PGP Keyring Management</h2>

<template>
    <tr id="pgpkey-template">
        <td>
            <div id="trustlevel" style="font-size: 14pt;"><b>Trust Level:</b> Ultimate</div>
            <code id="uids">
                ðŸ¤– Power Mail-in-a-Box Management Daemon &lt;administrator@mailinabox.lan&gt;
            </code>
            <h3 style="font-size: 12pt;">Subkeys</h3>
            <table id="subkeys">
                <tr id="subkey-template">
                    <td id="ismaster">ðŸ”‘</td>
                    <td>
                        <b>
                            <a id="sign">S</a>
                            <a id="cert">C</a>
                            <a id="encr">E</a>
                            <a id="auth">A</a>
                        </b>
                    </td>
                    <td>
                        <b id="algo">RSA, 3072 bit</b>
                    </td>
                    <td>
                        <pre id="fpr">1756 6B81 D8A4 24C7 0098  659E 6872 2633 F692 52C6</pre>
                    </td>
                    <td id="expiration">
                        12/12/20 (119 days)
                    </td>
                </tr>
            </table>
        </td>
        <td style="width: 140pt;">
            <button id="export" class="btn btn-primary btn-block">Export Public Key</button>
        </td>
    </tr>
</template>

<div id="pgp_keyring_config">
    <h3>Daemon's Private Key</h3>
    <table id="privatekey" class="table container">  
    </table>

    <h3>Imported Public Keys</h3>
    <table id="pubkeys" class="table container">
    </table>
</div>

<script>
    function pretty_print_key(key, darken_bg, daemon) {
        // Placeholder
        return `<tr class=${darken_bg ? "\"bg-light\"" : "\"\""}><td>${key.master_fpr} ${daemon ? "(Daemon)" : ""}</td></tr>`
    }

    function show_pgp_keyring() {
        $('#privatekey tbody').html("<tr><td class='text-muted'>Loading...</td></tr>")
        $('#pubkeys tbody').html("<tr><td class='text-muted'>Loading...</td></tr>")
        api(
            "/system/pgp/",
            "GET",
            {},
            function(r) {
                $("#privatekey").append(pretty_print_key(r.daemon, true, true))
                let pendulum = 1
                r.imported.forEach(k => {
                    $("#pubkeys").append(pretty_print_key(k, pendulum > 0, false))
                    pendulum *= -1
                });
            }
        )
    }
</script>
